---
title: "Is There a Correlation Between Different Licensed Business Categories That Share One Postal Code? An Analysis from the 2022 Toronto Business Licenses"
subtitle: "My subtitle if needed"
author: 
  - Allyson Cui
thanks: "Code and data are available at: https://open.toronto.ca/dataset/municipal-licensing-and-standards-business-licences-and-permits/"
date: "`r Sys.time()`"
date-format: "D MMMM YYYY"
output:
  bookdown::pdf_document2
toc: TRUE
abstract: "The cluster of different types of business is an extraordinary phenomenon in economics, as it reflects the synergy between various categories within a localized ecosystem. On the other hand, some business types tends to stay away from each other. Based on the evidence from OpenData for Toronto 2022, we proved that out of the 68 prescribed business categories, which composes 3003 unique pair of combinations, 1% of them have correlation coefficients higher than 0.194, with the highest being 0.930."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
```


# Introduction

**Background**: Geographical business clusters represent a fascinating aspect of modern economics, embodying a localized synergy among diverse business categories. These clusters often emerge as hotbeds of innovation, enhanced production, and efficient resource allocation~\cite{Lublinski2002}. However, not all business types are inclined to cluster together, leading to a complex landscape where spatial proximity does not always indicate functional interaction or collaboration. Existing literature focuses on the identification of these clusters, particularly in specialized sectors like aeronautics~\cite{Lublinski2002}. Furthermore, other works delve into how these clusters evolve their innovation capabilities, based on a model that adapts to the cluster's development stage~\cite{Bittencourt2019}. While these studies offer valuable insights, there is an evident gap in the quantitative analysis of what business types tend to co-locate and the nature of their interactions within a generalized urban setting.

**Literature Review**: To fill this gap, the present study leverages OpenData for Toronto 2022 to undertake an exhaustive analysis of 81 prescribed business categories and their spatial relationships. By creating 3828 unique pairs of business category combinations, this research aims to scrutinize the extent to which certain categories display valid correlations in their geographic distribution. Unlike previous studies that focused primarily on specialized sectors or qualitative aspects~\cite{Lublinski2002, Bittencourt2019}, our research employs statistical methods to provide a comprehensive, data-driven perspective.

**Research Gap**: This paper is organized as follows: the first section reviews existing literature on geographical business clusters, highlighting the methodologies employed and gaps that need to be filled. The second section describes the methodology adopted in this study, followed by a section detailing the findings. Finally, the paper concludes with a discussion of the implications of our research, and suggestions for future studies in this domain.

**Objectives and Stucture of This Paper**: In summary, this study contributes to the existing body of research by introducing a quantitative methodology to examine the nature and extent of business clustering in a large urban area. By doing so, it offers a multi-faceted understanding of the phenomenon, adding a valuable layer of complexity to our current understanding of geographical business clusters.


# Data

## Data Sources

The key elements in the research question are the business category and its location. This leads to a question of the definition of category and the precision of location that we use as a standard to determine whether the businesses are 'clustered'. There are myriads of ways to classify professions, and since we are interested in the licenced businesses, it would make the most sense if we are using the same criteria that the government officials use when they are issuing those licenses. For the location, we have the choices from city, postal code, to street number. We chose the postal code as the geographical signal to focus on, since the unit of city is too obscure for observing the clusters, and the street number may be to specific to each of the businesses. One postal code usually covers an area of 0.5 to 1 square kilometer, which is within a person's walkable distance, and it could be reasonable to find some existing relationship among businesses located in that area. Another minor piece of information that we also need to pay attention to is the time of which the business is operating under that licence. A licence usually has an issue date and an expiration date, and the cluster that we are interested in intrinsicly means that the businesses have to be operating at around the same time.

Following those guidelines, we found the data set "Municipal Licensing and Standards - Business Licences and Permits", which is collected by Toronto Municipal Licensing & Standards (ML&S) and published on Toronto Open Data Portal.

## Data Selection and Preparation

The dataset contains 155037 observations and 18 variables about specific categories of licences and permits including the aspects that we are interested in: licence/permit category, business address, date issued, and cancel date. There are a total of 81 categories and 16607 postal codes. For the purpose of the study, we will assume that the businesses owning the licence will operate throughout the valid time period. However, we will only focus on the recent relationship that took place so we first would filter out the old licences, and that those postal codes which only have a single type of business is also not within the interests, so we filter them out as well.

Now, we look into the latest year, 2022. The target data includes licenced businesses which have operated on any day in 2022 (date issued no later than 2022.12.31 and cancel data no earlier than 2022.01.01. Moreover, there are many postal codes which only has one business category on record, or, only has three letters which indicates areas that are too broad for our study. This eliminates the number of postal codes down to 3919. Then, we removed the categories that are not present in any of the 3919 postal codes, this leaves us with 68 out of the 81 categories. We reorganized the data set so that we have the number of licences per category by postal code laid out as Table 1.

```{r dataextract, echo=FALSE, message=FALSE}
# Set up libraries
library(knitr)
library(kableExtra)
library(dplyr)  # Import dplyr for data manipulation functions like slice() and select()

# Read the cleaned data
cleaned_data <- read_csv(here::here("outputs/data/cleaned_data.csv"))

# Create a table with selected rows and columns
cleaned_data %>%
  slice(1:5) %>%                 # Select first 5 rows
  select(1:4) %>%                # Select first 4 columns
  kable(caption = "Number of Licence per Category by Postal Code: Sample Data",
        col.names = c("Postal Code", "ADULT ENTERTAINMENT CLUB", "BILLIARD HALL", "BODY RUB PARLOUR"),
        linesep = "", 
        digits = 1, 
        booktabs = TRUE) %>%
  kable_styling(latex_options = "HOLD_position", font_size = 10)

```

## Data Description

Although in Table 1 the sample does not show non-zero values, we still have the outlook of how the data is organized. You will notice that there are postal codes which does not start with letter M, which represents an area within Greater Toronto Area (GTA), this means that there are businesses requested and received licenses but are not headquatering in GTA but in other places. We didn't exclude those businesses because this doesn't affect our analysis on the correlation between categories, since businesses located in other places are also surrounded and supported by the neighbour businesses.

# Exploratory Data Analysis

Note that the data now is focusing on the postal codes which have at least two different business categories licensed.

## Business Categories
```{r}
# Find the max, mean, and sum for each category
max_values <- apply(reshaped_data[-1], 2, max)
mean_values <- apply(reshaped_data[-1], 2, function(x) mean(x[x > 0], na.rm = TRUE))
sum_values <- apply(reshaped_data[-1], 2, sum)

# Create tibbles and arrange them in descending order
max_values_tibble <- tibble(column_name = names(max_values), max_value = as.numeric(max_values)) %>% arrange(desc(max_value))
mean_values_tibble <- tibble(column_name = names(mean_values), mean_value = as.numeric(mean_values)) %>% arrange(desc(mean_value))
sum_values_tibble <- tibble(column_name = names(sum_values), sum_value = as.numeric(sum_values)) %>% arrange(desc(sum_value))

# Select the top 10 categories
top_10_max <- head(max_values_tibble, 10)
top_10_mean <- head(mean_values_tibble, 10)
top_10_sum <- head(sum_values_tibble, 10)

# Create the bar chart for max values
ggplot(top_10_max, aes(x = reorder(column_name, max_value), y = max_value)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(
    title = "Top 10 Categories with the Highest Maximum Number of Licenses in a Single Postal Code",
    x = "Category",
    y = "Maximum Number of Licenses"
  ) +
  theme(plot.title = element_text(hjust = 0.5))

# Create the bar chart for mean values
ggplot(top_10_mean, aes(x = reorder(column_name, mean_value), y = mean_value)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(
    title = "Top 10 Categories with the Highest Average Number of Licenses, Ignoring Postal Codes with No License of That Particular Category",
    x = "Category",
    y = "Average Number of Licenses "
  ) +
  theme(plot.title = element_text(hjust = 0.5))

# Create the bar chart for sum values
ggplot(top_10_sum, aes(x = reorder(column_name, sum_value), y = sum_value)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(
    title = "Top 10 Categories with the Highest Total Number of Licenses",
    x = "Category",
    y = "Total Number of Licenses"
  ) +
  theme(plot.title = element_text(hjust = 0.5))

```


# Correlation Analysis

This section comes to the core of the research question - the correlation between pairwise business categories.

## Methodology

First, we develop a correlation matrix using the cleaned data using the built-in generation function. Second, we extract all unique pairwise combinations and their coefficients, ensuring that each pair is only considered once (e.g., the pair 'Restaurant, Retail' is the same as 'Retail, Restaurant' and is considered only once). Then, we resulted in Table 2.


## Results and Interpretation
```{r dataextract, echo=FALSE, message=FALSE}
# Read the analysis data
analysis_data <- read_csv(here::here("outputs/data/analysis_data.csv"))

# Create a table with selected rows
analysis_data %>%
  slice(1:10) %>%                 # Select first 5 rows
  kable(caption = "Any Two Categories and Their Correlation Coefficients: Sample Data",
        col.names = c("Category A", "Category B", "Correlation Coefficient"), 
        linesep = "", 
        digits = c(0, 0, 5), 
        booktabs = TRUE) %>%
  kable_styling(latex_options = "HOLD_position", font_size = 10)

selected_data <- tail(analysis_data, 10)
# Generate the table
selected_data %>%
  slice(1:10) %>%                 # Select first 5 rows
  kable(caption = "Any Two Categories and Their Correlation Coefficients: Sample Data",
        col.names = c("Category A", "Category B", "Correlation Coefficient"), 
        linesep = "", 
        digits = c(0, 0, 5), 
        booktabs = TRUE) %>%
  kable_styling(latex_options = "HOLD_position", font_size = 10)

```

```{r}
ggplot(analysis_data, aes(x = correlation_coefficient)) +
  geom_density(fill = "blue", alpha = 0.7) +
  labs(title = "Density Plot of Correlation Coefficients",
       x = "Correlation Coefficient",
       y = "Density")
```
```{r}
#install.packages("Hmisc")
library(Hmisc)

# Generate the summary
print(describe(analysis_data$correlation_coefficient))

```
```{r}
quantile(analysis_data$correlation_coefficient, 0.99, na.rm = TRUE)

```

# Discussion

## First discussion point {#sec-first-point}


## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}



\newpage


# References

